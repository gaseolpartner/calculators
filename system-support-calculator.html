<!DOCTYPE html>
<!--
==============================================================
                     ⚠️ 중요 경고 ⚠️
==============================================================
파일명: 시스템 동바리 계산기.html

이 파일의 파일명과 내용을 변경하지 마십시오.
본 프로그램은 저작권법에 의해 보호되고 있습니다.

© 2025 가설파트너. All rights reserved.

무단 복제, 수정, 배포 시 법적 처벌을 받을 수 있습니다.
문의: 010-7970-2108 | fc112@naver.com
==============================================================
-->
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="가설파트너 - 시스템 동바리 물량 계산기 v1.0">
    <meta name="author" content="가설파트너">
    <meta name="keywords" content="시스템동바리, 서포트, 물량산출, 건설, 가설구조물">
    <meta name="copyright" content="© 2025 가설파트너. All rights reserved.">
    <meta name="generator" content="가설파트너 시스템 동바리 v1.0">
    <meta name="application-name" content="시스템 동바리 물량 계산기">
    <meta name="msapplication-tooltip" content="가설파트너 시스템 동바리 물량 계산기">
    <meta name="msapplication-TileColor" content="#2a5298">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>시스템 동바리 물량 계산기 v1.0 - 가설파트너</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K8NMSLZ841"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-K8NMSLZ841');
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* 텍스트 선택 방지 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* 드래그 방지 */
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
        }
        
        /* 입력 필드는 선택 가능하게 */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        body {
            font-family: 'Malgun Gothic', 'Noto Sans KR', sans-serif;
            background: #1a1a1a;
            color: #fff;
            overflow-x: hidden;
            /* 이미지 및 요소 보호 */
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* 워터마크 */
        body::before {
            content: "© 2025 가설파트너";
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 120px;
            color: rgba(255, 255, 255, 0.02);
            z-index: -1;
            pointer-events: none;
            white-space: nowrap;
        }
        
        /* 상단 헤더 */
        .company-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .company-header::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            bottom: -50%;
            left: -50%;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .company-name {
            font-size: 32px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            position: relative;
            z-index: 1;
        }
        
        .program-title {
            font-size: 20px;
            color: #fff;
            margin-top: 10px;
            opacity: 0.9;
        }
        
        /* 법적 공지 */
        .legal-notice {
            background: #ffeeee;
            border: 2px solid #ff4444;
            padding: 15px;
            margin: 20px;
            border-radius: 5px;
            color: #aa0000;
            font-weight: bold;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        /* 메인 컨테이너 */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 입력 섹션 */
        .input-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section-title {
            color: #1e3c72;
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #2a5298;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #fff;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }
        
        select.input-field {
            cursor: pointer;
        }
        
        /* 구조 타입 선택 */
        .structure-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .structure-type-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .structure-type-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #2a5298;
        }
        
        .structure-type-card p {
            font-size: 14px;
            opacity: 0.8;
            color: #2a5298;
        }
        
        .structure-type-card:hover {
            border-color: #2a5298;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(42, 82, 152, 0.2);
        }
        
        .structure-type-card.active {
            background: #2a5298;
            color: white;
            border-color: #2a5298;
        }
        
        .structure-type-card.active h3,
        .structure-type-card.active p {
            color: white;
        }
        
        /* 안전율 슬라이더 */
        .safety-rate-container {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #2a5298;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #2a5298;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .slider-value {
            min-width: 80px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #2a5298;
        }
        
        /* 계산 버튼 */
        .calculate-button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .calculate-button::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .calculate-button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .calculate-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(42, 82, 152, 0.3);
        }
        
        /* 결과 섹션 */
        .result-section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .result-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .result-header {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .result-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .result-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #2a5298;
        }
        
        .result-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .result-value {
            color: #2a5298;
            font-size: 32px;
            font-weight: bold;
        }
        
        .result-unit {
            color: #888;
            font-size: 16px;
            margin-left: 5px;
        }
        
        /* 상세 테이블 */
        .detail-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
        }
        
        .detail-table th {
            background: #2a5298;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: white;
            border-bottom: 2px solid #1e3c72;
        }
        
        .detail-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            color: #333;
        }
        
        .detail-table tr:hover {
            background: #f0f4ff;
        }
        
        .detail-table td[colspan] {
            background: #e8f0ff;
            font-weight: bold;
            color: #1e3c72;
        }
        
        /* 단가 입력 섹션 */
        .price-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }
        
        .price-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .price-header h3 {
            color: #1e3c72;
            font-size: 20px;
        }
        
        .price-header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .toggle-price-btn, .price-action-btn {
            background: #2a5298;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }
        
        .toggle-price-btn:hover, .price-action-btn:hover {
            background: #1e3c72;
        }
        
        .price-input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: #f0f4f8;
            border-radius: 8px;
        }
        
        .price-input-item {
            display: grid;
            grid-template-columns: minmax(120px, 1.5fr) 1fr 1fr;
            gap: 5px;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            font-size: 13px;
        }
        
        .price-input-item label {
            font-size: 12px;
            color: #555;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .price-input-item input {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            text-align: right;
            width: 100%;
        }
        
        .usage-days-container {
            background: #e8f0ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .usage-days-container label {
            color: #1e3c72;
            font-weight: bold;
        }
        
        .usage-days-container input {
            width: 80px;
            padding: 6px;
            border: 2px solid #2a5298;
            border-radius: 5px;
            font-size: 14px;
            text-align: center;
        }
        
        /* 데이터 취합 섹션 */
        .combine-section {
            background: #f0f8ff;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border: 2px solid #4169e1;
        }
        
        .combine-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .combine-header h3 {
            color: #1e3c72;
            font-size: 20px;
        }
        
        .saved-data-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .saved-data-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .saved-data-item:hover {
            border-color: #2a5298;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .saved-data-item.selected {
            border-color: #2a5298;
            background: #e8f0ff;
        }
        
        .saved-data-item h4 {
            color: #1e3c72;
            margin-bottom: 5px;
        }
        
        .saved-data-item p {
            font-size: 13px;
            color: #666;
            margin: 2px 0;
        }
        
        /* 요약 정보 */
        .summary-box {
            background: linear-gradient(135deg, #f6f9fc 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
            border: 1px solid #dee2e6;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            text-align: center;
        }
        
        .summary-item {
            padding: 15px;
        }
        
        .summary-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .summary-value {
            color: #1e3c72;
            font-size: 24px;
            font-weight: bold;
        }
        
        /* 법적 고지 박스 */
        .legal-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
        }
        
        .legal-warning h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .legal-warning p {
            color: #856404;
            line-height: 1.6;
        }
        
        /* 버튼 그룹 */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .button-primary {
            background: #2a5298;
            color: white;
        }
        
        .button-primary:hover {
            background: #1e3c72;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 82, 152, 0.3);
        }
        
        .button-secondary {
            background: #6c757d;
            color: white;
        }
        
        .button-secondary:hover {
            background: #5a6268;
        }
        
        .button-success {
            background: #28a745;
            color: white;
        }
        
        .button-success:hover {
            background: #218838;
        }
        
        /* 하단 정보 */
        .footer-info {
            background: #222;
            color: #aaa;
            padding: 40px 20px;
            text-align: center;
            margin-top: 60px;
        }
        
        .footer-info h3 {
            color: #fff;
            margin-bottom: 20px;
        }
        
        .footer-info p {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        .footer-info a {
            color: #2a5298;
            text-decoration: none;
        }
        
        .footer-info a:hover {
            color: #4169e1;
            text-decoration: underline;
        }
        
        .copyright {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #444;
            font-size: 14px;
            color: #888;
        }
        
        /* 모달 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalShow 0.3s ease-out;
        }
        
        @keyframes modalShow {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .modal-title {
            font-size: 24px;
            color: #1e3c72;
            margin: 0;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            color: #999;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        /* 인쇄 스타일 */
        @media print {
            body {
                background: white;
                color: black;
            }
            
            .no-print {
                display: none !important;
            }
            
            .result-card {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        /* 반응형 */
        @media (max-width: 768px) {
            .company-name {
                font-size: 24px;
            }
            
            .program-title {
                font-size: 16px;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .result-grid {
                grid-template-columns: 1fr;
            }
            
            .structure-types {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button {
                width: 100%;
            }
        }
        
        /* 디버그 정보 표시용 */
        .debug-info {
            background: #f0f0f0;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #333;
        }
        
        .debug-info h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }
        
        .debug-info pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body oncontextmenu="return false" ondragstart="return false" onselectstart="return false">
    <!-- 상단 헤더 -->
    <div class="company-header">
        <h1 class="company-name">가설파트너</h1>
        <p class="program-title">시스템 동바리 물량 계산기 v1.0</p>
    </div>
    
    <!-- 법적 공지 -->
    <div class="legal-notice">
        ⚠️ 본 프로그램은 참고용 물량 산출 프로그램입니다. 정확한 실 수량은 배치 도면을 참고하여 사용하시기 바랍니다.
    </div>
    
    <!-- 메인 컨테이너 -->
    <div class="main-container">
        <!-- 입력 섹션 -->
        <div class="input-section">
            <h2 class="section-title">🏗️ 시스템 동바리 설치 정보 입력</h2>
            
            <!-- 구조 타입 선택 -->
            <div class="structure-types">
                <div class="structure-type-card active" onclick="selectStructureType('wall', this)">
                    <h3>벽식구조</h3>
                    <p>일반 아파트, 주상복합</p>
                </div>
                <div class="structure-type-card" onclick="selectStructureType('truss', this)">
                    <h3>트러스구조</h3>
                    <p>대공간 구조물</p>
                </div>
                <div class="structure-type-card" onclick="selectStructureType('beam', this)">
                    <h3>단독보구조</h3>
                    <p>보 단독 시공</p>
                </div>
                <div class="structure-type-card" onclick="selectStructureType('tg', this)">
                    <h3>TG보구조</h3>
                    <p>Transfer Girder</p>
                </div>
                <div class="structure-type-card" onclick="selectStructureType('tp', this)">
                    <h3>TP구조</h3>
                    <p>Transfer Plate</p>
                </div>
                <div class="structure-type-card" onclick="selectStructureType('ramp', this)">
                    <h3>RAMP</h3>
                    <p>경사로 구조</p>
                </div>
                <div class="structure-type-card" onclick="selectStructureType('deck', this)">
                    <h3>DECK</h3>
                    <p>데크플레이트</p>
                </div>
                <div class="structure-type-card" onclick="selectStructureType('deck900', this)">
                    <h3>DECK+900</h3>
                    <p>높은 데크플레이트</p>
                </div>
            </div>
            
            <!-- 기본 입력 정보 -->
            <div class="input-grid">
                <div class="input-group">
                    <label class="input-label" for="volume">공루베 (㎥)</label>
                    <input type="number" class="input-field" id="volume" value="100" step="0.1" min="0">
                </div>
                <div class="input-group">
                    <label class="input-label" for="height">층고 (mm)</label>
                    <input type="number" class="input-field" id="height" value="5000" step="100" min="2000" max="10000">
                </div>
                <div class="input-group">
                    <label class="input-label" for="slabThk">슬라브 두께 (mm)</label>
                    <input type="number" class="input-field" id="slabThk" value="200" step="10" min="100" max="500">
                </div>
                <div class="input-group">
                    <label class="input-label" for="beamThk">보 두께 (mm)</label>
                    <input type="number" class="input-field" id="beamThk" value="0" step="50" min="0" max="2000">
                </div>
            </div>
            
            <!-- 안전율 설정 -->
            <div class="safety-rate-container">
                <label class="input-label">안전율 설정 (%)</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="safetyRate" min="0" max="15" value="0" step="1">
                    <div class="slider-value"><span id="safetyRateDisplay">0</span>%</div>
                </div>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">
                    * 현장 여건에 따라 1~15% 범위에서 조정 가능합니다. 실제 현장 조건에 따라 데이터가 상이할 수 있습니다.
                </p>
            </div>
            
            <!-- 계산 버튼 -->
            <button class="calculate-button" onclick="calculateQuantity()">
                물량 계산하기
            </button>
        </div>
        
        <!-- 결과 섹션 -->
        <div class="result-section" id="resultSection">
            <div class="result-card">
                <div class="result-header">
                    <h2 class="result-title">📊 시스템 동바리 물량 산출 결과</h2>
                    <p id="resultInfo" style="margin-top: 10px;"></p>
                </div>
                
                <!-- 주요 자재 수량 -->
                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">수직재 (Vertical)</div>
                        <div>
                            <span class="result-value" id="verticalCount">0</span>
                            <span class="result-unit">개</span>
                        </div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">수평재 (Horizontal)</div>
                        <div>
                            <span class="result-value" id="horizontalCount">0</span>
                            <span class="result-unit">개</span>
                        </div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">U-헤드잭</div>
                        <div>
                            <span class="result-value" id="uheadCount">0</span>
                            <span class="result-unit">개</span>
                        </div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">베이스잭</div>
                        <div>
                            <span class="result-value" id="baseCount">0</span>
                            <span class="result-unit">개</span>
                        </div>
                    </div>
                </div>
                
                <!-- 단가 입력 섹션 -->
                <div class="price-section">
                    <div class="price-header">
                        <h3>💰 자재 단가 입력</h3>
                        <div class="price-header-buttons">
                            <button class="toggle-price-btn" onclick="togglePriceSection()">단가 입력</button>
                            <button class="price-action-btn" onclick="savePriceData()">단가 저장</button>
                            <button class="price-action-btn" onclick="loadPriceData()">단가 불러오기</button>
                        </div>
                    </div>
                    
                    <div id="priceInputContainer" style="display: none;">
                        <div class="usage-days-container">
                            <label for="usageDays">사용 일수:</label>
                            <input type="number" id="usageDays" value="30" min="1" max="365">일
                            <button class="button button-primary" onclick="calculatePrice()" style="margin-left: auto;">
                                금액 계산하기
                            </button>
                        </div>
                        
                        <div class="price-input-grid" id="priceInputGrid">
                            <!-- 동적으로 생성됨 -->
                        </div>
                    </div>
                </div>
                
                <!-- 데이터 취합 섹션 -->
                <div class="combine-section" id="combineSection" style="display: none;">
                    <div class="combine-header">
                        <h3>📊 데이터 취합</h3>
                        <button class="button button-primary" onclick="combineData()">
                            선택한 데이터 취합하기
                        </button>
                    </div>
                    
                    <div class="saved-data-list" id="savedDataList">
                        <!-- 저장된 데이터 목록 표시 -->
                    </div>
                </div>
                
                <!-- 상세 수량 테이블 -->
                <h3 style="margin-top: 40px; margin-bottom: 20px; color: #1e3c72; font-size: 20px;">📋 상세 자재 수량</h3>
                <table class="detail-table">
                    <thead>
                        <tr>
                            <th>품명</th>
                            <th>규격</th>
                            <th>수량</th>
                            <th>단위중량(kg)</th>
                            <th>총중량(kg)</th>
                            <th class="price-column" style="display: none;">기본료(원)</th>
                            <th class="price-column" style="display: none;">일단가(원)</th>
                            <th class="price-column" style="display: none;">총금액(원)</th>
                        </tr>
                    </thead>
                    <tbody id="detailTableBody">
                        <!-- 동적으로 추가됨 -->
                    </tbody>
                </table>
                
                <!-- 요약 정보 -->
                <div class="summary-box">
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">설치 체적</div>
                            <div class="summary-value" id="totalVolume">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">실작업 높이</div>
                            <div class="summary-value" id="workHeight">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">총 중량</div>
                            <div class="summary-value" id="totalWeight">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">㎥당 중량</div>
                            <div class="summary-value" id="weightPerM3">-</div>
                        </div>
                        <div class="summary-item price-summary" style="display: none;">
                            <div class="summary-label">총 자재비</div>
                            <div class="summary-value" id="totalPrice">-</div>
                        </div>
                        <div class="summary-item price-summary" style="display: none;">
                            <div class="summary-label">㎥당 단가</div>
                            <div class="summary-value" id="pricePerM3">-</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px;">
                        <p style="color: #1e3c72; font-size: 14px; margin: 0;">
                            <strong>실작업 높이 계산식:</strong><br>
                            실작업 높이 = 층고 - 슬라브 두께 - 보 두께 - 멍에재(125mm) - 헤드베이스(300mm) - 잭베이스(300mm) - 소켓(120mm) - 합판(12mm) - 장선(50mm)
                        </p>
                    </div>
                </div>
                
                <!-- 법적 고지 -->
                <div class="legal-warning">
                    <h3>⚠️ 중요 안내사항</h3>
                    <p>
                        본 계산 결과는 참고용이며, 실제 현장 조건에 따라 수량이 달라질 수 있습니다.<br>
                        정확한 실 수량은 배치 도면을 참고하여 사용하시기 바랍니다.<br>
                        <strong style="color: #ff0000;">본 프로그램은 견적시 참고용으로 사용하시고 실수량으로 사용함에 책임이 없습니다.</strong>
                    </p>
                </div>
                
                <!-- 버튼 그룹 -->
                <div class="button-group">
                    <button class="button button-primary no-print" onclick="window.print()">
                        🖨️ 인쇄하기
                    </button>
                    <button class="button button-primary no-print" onclick="generateQuotation()">
                        📄 견적서 생성
                    </button>
                    <button class="button button-success no-print" onclick="exportToExcel()">
                        📊 엑셀 내보내기
                    </button>
                    <button class="button button-success no-print" onclick="saveCurrentCalculation()">
                        💾 현재 결과 저장
                    </button>
                    <button class="button button-secondary no-print" onclick="resetCalculator()">
                        🔄 초기화
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 하단 정보 -->
    <div class="footer-info">
        <h3>가설파트너</h3>
        <p>
            가설재 프로그램 및 구조 검토<br>
            📞 문의: 010-7970-2108 | ✉️ 이메일: fc112@naver.com<br>
            🌐 웹사이트: <a href="https://gaseolpartner.com" target="_blank">gaseolpartner.com</a>
        </p>
        <div class="copyright">
            <p>
                © 2025 가설파트너. All rights reserved.<br>
                본 프로그램의 모든 저작권은 가설파트너에 있습니다.<br>
                무단 복제 및 배포를 금지합니다.
            </p>
        </div>
    </div>
    
    <script>
        // 초기 보안 경고
        console.log('%c⚠️ 정지!', 'color: red; font-size: 50px; font-weight: bold;');
        console.log('%c본 프로그램의 모든 코드는 저작권으로 보호됩니다.', 'color: red; font-size: 16px;');
        console.log('%c© 2025 가설파트너. All rights reserved.', 'color: #2a5298; font-size: 16px; font-weight: bold;');
        
        // 전역 변수
        let currentStructureType = 'wall';
        let calculatedMaterials = {};
        let priceData = {};
        let savedCalculations = [];
        let selectedDataIndices = [];
        let savedPriceInputs = {}; // 단가 입력값 저장용
        
        // Google Analytics 데이터 전송 함수
function sendPriceAnalytics(structureType, materials, totalPrice, usageDays) {
    // 평균 단가 계산
    let avgBasicPrice = 0;
    let avgDailyPrice = 0;
    let materialCount = 0;
    
    Object.keys(materials).forEach(key => {
        if (materials[key] && materials[key].quantity > 0) {
            const price = savedPriceInputs[key] || defaultPrices[key] || { basic: 0, daily: 0 };
            avgBasicPrice += price.basic;
            avgDailyPrice += price.daily;
            materialCount++;
        }
    });
    
    if (materialCount > 0) {
        avgBasicPrice = Math.round(avgBasicPrice / materialCount);
        avgDailyPrice = Math.round(avgDailyPrice / materialCount);
    }
    
    // 1. 전체 계산 이벤트
    gtag('event', 'price_calculation', {
        'event_category': '단가계산',
        'event_label': structureType,
        'value': totalPrice,
        'structure_type': structureType,
        'avg_basic_price': avgBasicPrice,
        'avg_daily_price': avgDailyPrice,
        'total_price': totalPrice,
        'material_count': materialCount,
        'usage_days': usageDays
    });
    
    // 2. 자재별 상세 이벤트
    Object.keys(materials).forEach(key => {
        if (materials[key] && materials[key].quantity > 0) {
            const price = savedPriceInputs[key] || defaultPrices[key] || { basic: 0, daily: 0 };
            gtag('event', 'material_price', {
                'event_category': '자재단가',
                'event_label': materialNames[key],
                'structure_type': structureType,
                'material_name': materialNames[key],
                'material_code': key,
                'basic_price': price.basic,
                'daily_price': price.daily,
                'quantity': materials[key].quantity,
                'usage_days': usageDays
            });
        }
    });
}

        // 구조별 자재 비율 데이터 (엑셀 파일 기반 - 1㎥당 비율)
        const materialRatios = {
            wall: {
                name: '벽식구조',
                ratios: {
                    'P17': { ratio: 0.16203370301022613, weight: 8.0 },
                    'P12': { ratio: 0.07921647702722166, weight: 6.2 },
                    'P08': { ratio: 0.12017499639925106, weight: 4.4 },
                    'P04': { ratio: 0.06361323155216285, weight: 3.0 },
                    'P02': { ratio: 0.06121273224830765, weight: 2.0 },
                    'H18': { ratio: 0.03795189399395075, weight: 5.0 },
                    'H15': { ratio: 0.03478323491286187, weight: 4.3 },
                    'H12': { ratio: 0.1114791876710356, weight: 3.5 },
                    'H09': { ratio: 0.0653896010370157, weight: 2.8 },
                    'H06': { ratio: 0.04918623073599309, weight: 2.1 },
                    'H03': { ratio: 0.011018291804695378, weight: 1.3 },
                    'H': { ratio: 0.16383407748811754, weight: 5.4 },
                    'J': { ratio: 0.16383407748811754, weight: 5.0 },
                    'S': { ratio: 0.16383407748811754, weight: 0.5 },
                    'T': { ratio: 0, weight: 19.5 },
                    'M3': { ratio: 0.008137692640069135, weight: 27.0 },
                    'M2.5': { ratio: 0.03816793893129771, weight: 22.5 },
                    'M2': { ratio: 0.028445916750684145, weight: 18.0 },
                    'M1.5': { ratio: 0.009650007201497912, weight: 13.5 },
                    'M1': { ratio: 0.008929857410341352, weight: 9.0 }
                }
            },
            truss: {
                name: '트러스구조',
                ratios: {
                    'P17': { ratio: 0.14157582337749428, weight: 8.0 },
                    'P12': { ratio: 0.04081328527387373, weight: 6.2 },
                    'P08': { ratio: 0.046335067039752834, weight: 4.4 },
                    'P04': { ratio: 0.06902360262331203, weight: 3.0 },
                    'P02': { ratio: 0.08456974675645217, weight: 2.0 },
                    'H18': { ratio: 0.0025985638045209424, weight: 5.0 },
                    'H15': { ratio: 0.034871049763893935, weight: 4.3 },
                    'H12': { ratio: 0.07328668425653533, weight: 3.5 },
                    'H09': { ratio: 0.03357775533583743, weight: 2.8 },
                    'H06': { ratio: 0.03127856524151475, weight: 2.1 },
                    'H03': { ratio: 0.00460104128829156, weight: 1.3 },
                    'H': { ratio: 0.16903837172634847, weight: 5.4 },
                    'J': { ratio: 0.14157582337749428, weight: 5.0 },
                    'S': { ratio: 0.14157582337749428, weight: 0.5 },
                    'T': { ratio: 0.0137312741744271, weight: 19.5 },
                    'M3': { ratio: 0.02000614714018274, weight: 27.0 },
                    'M2.5': { ratio: 0.007839599557725238, weight: 22.5 },
                    'M2': { ratio: 0.04039549262941926, weight: 18.0 },
                    'M1.5': { ratio: 0.0212036419809758, weight: 13.5 },
                    'M1': { ratio: 0.0030400402358266507, weight: 9.0 }
                }
            },
            beam: {
                name: '단독보구조',
                ratios: {
                    'P17': { ratio: 0.19767223577998871, weight: 8.0 },
                    'P12': { ratio: 0.01536981415430824, weight: 6.2 },
                    'P08': { ratio: 0.07555847568988174, weight: 4.4 },
                    'P04': { ratio: 0.05162380326637882, weight: 3.0 },
                    'P02': { ratio: 0.09395532194480945, weight: 2.0 },
                    'H18': { ratio: 0.014783180026281208, weight: 5.0 },
                    'H15': { ratio: 0.01933546085977098, weight: 4.3 },
                    'H12': { ratio: 0.14473437206682935, weight: 3.5 },
                    'H09': { ratio: 0.07687253613666228, weight: 2.8 },
                    'H06': { ratio: 0.08043927163506663, weight: 2.1 },
                    'H03': { ratio: 0.006276985169889243, weight: 1.3 },
                    'H': { ratio: 0.19767223577998871, weight: 5.4 },
                    'J': { ratio: 0.19767223577998871, weight: 5.0 },
                    'S': { ratio: 0.19767223577998871, weight: 0.5 },
                    'T': { ratio: 0, weight: 19.5 },
                    'M3': { ratio: 0.023934672423502907, weight: 27.0 },
                    'M2.5': { ratio: 0.021118828608973152, weight: 22.5 },
                    'M2': { ratio: 0.019992491083161253, weight: 18.0 },
                    'M1.5': { ratio: 0.027032100619485636, weight: 13.5 },
                    'M1': { ratio: 0.006523371503660597, weight: 9.0 }
                }
            },
            tg: {
                name: 'TG보구조',
                ratios: {
                    'P17': { ratio: 0.4330397470641373, weight: 8.0 },
                    'P12': { ratio: 0.04375564588979223, weight: 6.2 },
                    'P08': { ratio: 0.08624096657633243, weight: 4.4 },
                    'P04': { ratio: 0.22193992773261068, weight: 3.0 },
                    'P02': { ratio: 0.19546070460704607, weight: 2.0 },
                    'H18': { ratio: 0.00818654019873532, weight: 5.0 },
                    'H15': { ratio: 0.026140469738030712, weight: 4.3 },
                    'H12': { ratio: 0.12042682926829269, weight: 3.5 },
                    'H09': { ratio: 0.20172764227642276, weight: 2.8 },
                    'H06': { ratio: 0.4693992773261066, weight: 2.1 },
                    'H03': { ratio: 0.04477190605239385, weight: 1.3 },
                    'H': { ratio: 0.3517389340560072, weight: 5.4 },
                    'J': { ratio: 0.3517389340560072, weight: 5.0 },
                    'S': { ratio: 0.3517389340560072, weight: 0.5 },
                    'T': { ratio: 0, weight: 19.5 },
                    'M3': { ratio: 0.011630532971996387, weight: 27.0 },
                    'M2.5': { ratio: 0.01388888888888889, weight: 22.5 },
                    'M2': { ratio: 0.043642728093947605, weight: 18.0 },
                    'M1.5': { ratio: 0.02958446251129178, weight: 13.5 },
                    'M1': { ratio: 0.05634598012646793, weight: 9.0 }
                }
            },
            tp: {
                name: 'TP구조',
                ratios: {
                    'P17': { ratio: 0.4602929838087895, weight: 8.0 },
                    'P12': { ratio: 0, weight: 6.2 },
                    'P08': { ratio: 0.5165767154973016, weight: 4.4 },
                    'P04': { ratio: 0.09020817270624519, weight: 3.0 },
                    'P02': { ratio: 0.553585196607556, weight: 2.0 },
                    'H18': { ratio: 0, weight: 5.0 },
                    'H15': { ratio: 0.004626060138781804, weight: 4.3 },
                    'H12': { ratio: 0.015265998457979955, weight: 3.5 },
                    'H09': { ratio: 0.3365458750963763, weight: 2.8 },
                    'H06': { ratio: 0.4592521202775636, weight: 2.1 },
                    'H03': { ratio: 0.03781804163454125, weight: 1.3 },
                    'H': { ratio: 0.4556669236700077, weight: 5.4 },
                    'J': { ratio: 0.4556669236700077, weight: 5.0 },
                    'S': { ratio: 0.4556669236700077, weight: 0.5 },
                    'T': { ratio: 0, weight: 19.5 },
                    'M3': { ratio: 0.03006939090208173, weight: 27.0 },
                    'M2.5': { ratio: 0.13010794140323825, weight: 22.5 },
                    'M2': { ratio: 0.01734772552043177, weight: 18.0 },
                    'M1.5': { ratio: 0.010986892829606786, weight: 13.5 },
                    'M1': { ratio: 0.005088666152659985, weight: 9.0 }
                }
            },
            ramp: {
                name: 'RAMP',
                ratios: {
                    'P17': { ratio: 0.28581448360512013, weight: 8.0 },
                    'P12': { ratio: 0.07434683499912327, weight: 6.2 },
                    'P08': { ratio: 0.0680343678765562, weight: 4.4 },
                    'P04': { ratio: 0.16657899351218658, weight: 3.0 },
                    'P02': { ratio: 0.2735402419779064, weight: 2.0 },
                    'H18': { ratio: 0, weight: 5.0 },
                    'H15': { ratio: 0.06961248465719798, weight: 4.3 },
                    'H12': { ratio: 0.21637734525688238, weight: 3.5 },
                    'H09': { ratio: 0.07908118534104858, weight: 2.8 },
                    'H06': { ratio: 0.07960722426792917, weight: 2.1 },
                    'H03': { ratio: 0.027003331579870248, weight: 1.3 },
                    'H': { ratio: 0.28581448360512013, weight: 5.4 },
                    'J': { ratio: 0.28581448360512013, weight: 5.0 },
                    'S': { ratio: 0.28581448360512013, weight: 0.5 },
                    'T': { ratio: 0, weight: 19.5 },
                    'M3': { ratio: 0.03015956514115378, weight: 27.0 },
                    'M2.5': { ratio: 0.009644046992810802, weight: 22.5 },
                    'M2': { ratio: 0.06435209538839208, weight: 18.0 },
                    'M1.5': { ratio: 0.041732421532526744, weight: 13.5 },
                    'M1': { ratio: 0.010959144310012275, weight: 9.0 }
                }
            },
            deck: {
                name: 'DECK',
                ratios: {
                    'P17': { ratio: 0.20256109226889296, weight: 8.0 },
                    'P12': { ratio: 0, weight: 6.2 },
                    'P08': { ratio: 0.008948604226454476, weight: 4.4 },
                    'P04': { ratio: 0.3064309939994782, weight: 3.0 },
                    'P02': { ratio: 0.16184450821810592, weight: 2.0 },
                    'H18': { ratio: 0.2769240803548135, weight: 5.0 },
                    'H15': { ratio: 0.002625228280720063, weight: 4.3 },
                    'H12': { ratio: 0.4663448995564832, weight: 3.5 },
                    'H09': { ratio: 0.4663448995564832, weight: 2.8 },
                    'H06': { ratio: 0.4663448995564832, weight: 2.1 },
                    'H03': { ratio: 0, weight: 1.3 },
                    'H': { ratio: 0.15632663709887817, weight: 5.4 },
                    'J': { ratio: 0.05980954865640491, weight: 5.0 },
                    'S': { ratio: 0.017691755804852598, weight: 0.5 },
                    'T': { ratio: 0.04300808765979651, weight: 19.5 },
                    'M3': { ratio: 0.03542916775371772, weight: 27.0 },
                    'M2.5': { ratio: 0, weight: 22.5 },
                    'M2': { ratio: 0, weight: 18.0 },
                    'M1.5': { ratio: 0, weight: 13.5 },
                    'M1': { ratio: 0, weight: 9.0 }
                }
            },
            deck900: {
                name: 'DECK+900',
                ratios: {
                    'P17': { ratio: 0.5585288870591464, weight: 8.0 },
                    'P12': { ratio: 0, weight: 6.2 },
                    'P08': { ratio: 0.46932894195142033, weight: 4.4 },
                    'P04': { ratio: 0.13357119985362062, weight: 3.0 },
                    'P02': { ratio: 0.23054755043227665, weight: 2.0 },
                    'H18': { ratio: 0.09729655550981199, weight: 5.0 },
                    'H15': { ratio: 0.016284707927359227, weight: 4.3 },
                    'H12': { ratio: 0.12927130506381226, weight: 3.5 },
                    'H09': { ratio: 0.47687662961438176, weight: 2.8 },
                    'H06': { ratio: 0.2626595306710581, weight: 2.1 },
                    'H03': { ratio: 0.004940304652120214, weight: 1.3 },
                    'H': { ratio: 0.38753945382187455, weight: 5.4 },
                    'J': { ratio: 0.5585288870591464, weight: 5.0 },
                    'S': { ratio: 0.38753945382187455, weight: 0.5 },
                    'T': { ratio: 0, weight: 19.5 },
                    'M3': { ratio: 0.12186084808563195, weight: 27.0 },
                    'M2.5': { ratio: 0.22341155482365857, weight: 22.5 },
                    'M2': { ratio: 0.029641827912721283, weight: 18.0 },
                    'M1.5': { ratio: 0.02579936873885001, weight: 13.5 },
                    'M1': { ratio: 0.06806641965143406, weight: 9.0 }
                }
            }
        };
        
        // 자재 명칭 매핑
        const materialNames = {
            'P17': '수직재 P17 (1725mm)',
            'P12': '수직재 P12 (1291mm)',
            'P08': '수직재 P08 (863mm)',
            'P04': '수직재 P04 (432mm)',
            'P02': '수직재 P02 (216mm)',
            'H18': '수평재 H18 (1829mm)',
            'H15': '수평재 H15 (1524mm)',
            'H12': '수평재 H12 (1219mm)',
            'H09': '수평재 H09 (914mm)',
            'H06': '수평재 H06 (610mm)',
            'H03': '수평재 H03 (305mm)',
            'H': '헤드잭',
            'J': '잭베이스',
            'S': '소켓',
            'T': '트러스',
            'M3': '멍에재 3M',
            'M2.5': '멍에재 2.5M',
            'M2': '멍에재 2M',
            'M1.5': '멍에재 1.5M',
            'M1': '멍에재 1M'
        };
        
        // 기본 단가 데이터
        const defaultPrices = {
            'P17': { basic: 5000, daily: 160 },
            'P12': { basic: 3800, daily: 120 },
            'P08': { basic: 2500, daily: 80 },
            'P04': { basic: 1300, daily: 40 },
            'P02': { basic: 700, daily: 20 },
            'H18': { basic: 2500, daily: 80 },
            'H15': { basic: 2100, daily: 70 },
            'H12': { basic: 1700, daily: 55 },
            'H09': { basic: 1300, daily: 40 },
            'H06': { basic: 900, daily: 30 },
            'H03': { basic: 500, daily: 15 },
            'H': { basic: 2700, daily: 90 },
            'J': { basic: 2500, daily: 80 },
            'S': { basic: 300, daily: 10 },
            'T': { basic: 10000, daily: 330 },
            'M3': { basic: 8000, daily: 260 },
            'M2.5': { basic: 6700, daily: 220 },
            'M2': { basic: 5400, daily: 180 },
            'M1.5': { basic: 4000, daily: 130 },
            'M1': { basic: 2700, daily: 90 }
        };
        
        // 구조 타입 선택
        function selectStructureType(type, element) {
            currentStructureType = type;
            
            // 모든 카드에서 active 제거
            document.querySelectorAll('.structure-type-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // 선택된 카드에 active 추가
            if (element) {
                element.classList.add('active');
            }
        }
        
        // 안전율 슬라이더 업데이트
        document.getElementById('safetyRate').addEventListener('input', function() {
            document.getElementById('safetyRateDisplay').textContent = this.value;
        });
        
        // 물량 계산
        function calculateQuantity() {
            // 입력값 가져오기
            const volume = parseFloat(document.getElementById('volume').value);
            const height = parseFloat(document.getElementById('height').value);
            const slabThk = parseFloat(document.getElementById('slabThk').value);
            const beamThk = parseFloat(document.getElementById('beamThk').value);
            const safetyRate = parseFloat(document.getElementById('safetyRate').value) / 100;
            
            // 유효성 검사
            if (!volume || !height || !slabThk) {
                alert('모든 필수 값을 입력해주세요.');
                return;
            }
            
            // 실작업 높이 계산 (엑셀의 E6 수식과 동일)
            // E6: C2-SUM(C3:C7,E2:E5)
            // C2: 층고, C3: 슬라브, C4: 보, C5: 합판(12), C6: 장선1(50), C7: 장선2(0)
            // E2: 멍에(125), E3: 헤드베이스(300), E4: 잭베이스(300), E5: 소켓(120)
            const workHeight = height - slabThk - beamThk - 12 - 50 - 0 - 125 - 300 - 300 - 120;
            
            // 헤드잭 높이는 실제로 305.5mm 사용
            const headerHeight = 305.5;
            const jacketHeight = 305.5;
            
            // 현재 구조 타입의 비율 가져오기
            const structureData = materialRatios[currentStructureType];
            const ratios = structureData.ratios;
            
            // 수직재 규격
            const verticalSizes = {
                'P17': 1725,
                'P12': 1291,
                'P08': 863,
                'P04': 432,
                'P02': 216
            };
            
            // 자재별 수량 계산
            const materials = {};
            let totalWeight = 0;
            
            // 수직재 단수 계산 (엑셀 방식 구현)
            const verticalLayers = {};
            
            // P17: QUOTIENT(E6,C9) = QUOTIENT(실작업높이, 1725)
            verticalLayers['P17'] = Math.floor(workHeight / verticalSizes['P17']);
            const remainder1 = workHeight % verticalSizes['P17']; // MOD(E6,C9)
            
            // P12: QUOTIENT(D9,C10) = QUOTIENT(443, 1291)
            verticalLayers['P12'] = Math.floor(remainder1 / verticalSizes['P12']);
            const remainder2 = remainder1 % verticalSizes['P12']; // MOD(D9,C10)
            
            // P08: QUOTIENT(D10,C11) = QUOTIENT(443, 863)
            verticalLayers['P08'] = Math.floor(remainder2 / verticalSizes['P08']);
            const remainder3 = remainder2 % verticalSizes['P08']; // MOD(D10,C11)
            
            // P04: QUOTIENT(D11,C12) = QUOTIENT(443, 432)
            verticalLayers['P04'] = Math.floor(remainder3 / verticalSizes['P04']);
            const remainder4 = remainder3 % verticalSizes['P04']; // MOD(D11,C12)
            
            // P02: QUOTIENT(D12,C13) = QUOTIENT(11, 216)
            verticalLayers['P02'] = Math.floor(remainder4 / verticalSizes['P02']);
            
            // 수평재 단수 계산
            // B36: SUM(E9:E13) - 모든 수직재 단수의 합
            // C36: SUM(E11:E13) - P08, P04, P02의 단수 합
            // D36: SUM(E9:E13)+1 - 모든 수직재 단수의 합 + 1
            // F36: IF(C36=1, B36, D36)
            
            const totalVerticalLayers = Object.values(verticalLayers).reduce((sum, val) => sum + val, 0);
            const smallVerticalLayers = (verticalLayers['P08'] || 0) + (verticalLayers['P04'] || 0) + (verticalLayers['P02'] || 0);
            
            let horizontalLayers;
            if (smallVerticalLayers === 1) {
                horizontalLayers = totalVerticalLayers;
            } else {
                horizontalLayers = totalVerticalLayers + 1;
            }
            
            // 각 자재별 수량 계산
            for (const [material, data] of Object.entries(ratios)) {
                if (data.ratio > 0) {
                    let quantity = 0;
                    
                    // 수직재 수량 계산: HLOOKUP * 공루베 * 단수
                    if (verticalSizes[material]) {
                        const layers = verticalLayers[material] || 0;
                        quantity = data.ratio * volume * layers;
                    }
                    // 수평재 수량 계산: HLOOKUP * 공루베 * 수평재단수
                    else if (material.startsWith('H') && material.length === 3) {
                        quantity = data.ratio * volume * horizontalLayers;
                    }
                    // 기타 자재 수량 계산: HLOOKUP * 공루베
                    else {
                        quantity = data.ratio * volume;
                    }
                    
                    // 안전율 적용
                    quantity = quantity * (1 + safetyRate);
                    
                    if (quantity > 0) {
                        materials[material] = {
                            quantity: Math.ceil(quantity),
                            weight: Math.ceil(quantity) * data.weight,
                            unitWeight: data.weight
                        };
                        
                        totalWeight += materials[material].weight;
                    }
                }
            }
            
            // 전역 변수에 저장
            calculatedMaterials = materials;
            
            // 결과 표시
            displayResults(materials, volume, workHeight, totalWeight, structureData.name);
            
            // 단가 입력 필드 생성
            createPriceInputFields(materials);
        }
        
        // 단가 입력 필드 생성
        function createPriceInputFields(materials) {
            const priceInputGrid = document.getElementById('priceInputGrid');
            priceInputGrid.innerHTML = '';
            
            const allMaterials = ['P17', 'P12', 'P08', 'P04', 'P02', 'H18', 'H15', 'H12', 'H09', 'H06', 'H03', 'H', 'J', 'S', 'T', 'M3', 'M2.5', 'M2', 'M1.5', 'M1'];
            
            allMaterials.forEach(material => {
                if (materials[material] && materials[material].quantity > 0) {
                    const item = document.createElement('div');
                    item.className = 'price-input-item';
                    
                    const savedPrice = savedPriceInputs[material] || defaultPrices[material] || { basic: 0, daily: 0 };
                    
                    item.innerHTML = `
                        <label>${materialNames[material]}</label>
                        <input type="number" id="basic_${material}" placeholder="기본료" value="${savedPrice.basic}" min="0" step="100">
                        <input type="number" id="daily_${material}" placeholder="일단가" value="${savedPrice.daily}" min="0" step="10">
                    `;
                    priceInputGrid.appendChild(item);
                }
            });
        }
        
        // 단가 섹션 토글
        function togglePriceSection() {
            const container = document.getElementById('priceInputContainer');
            const btn = document.querySelector('.toggle-price-btn');
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                btn.textContent = '단가 입력 닫기';
            } else {
                container.style.display = 'none';
                btn.textContent = '단가 입력';
            }
        }
        
        // 금액 계산
        function calculatePrice() {
            const usageDays = parseInt(document.getElementById('usageDays').value) || 30;
            let totalPrice = 0;
            
            // 각 자재별 금액 계산
            Object.keys(calculatedMaterials).forEach(material => {
                const basicPrice = parseFloat(document.getElementById(`basic_${material}`)?.value) || 0;
                const dailyPrice = parseFloat(document.getElementById(`daily_${material}`)?.value) || 0;
                const quantity = calculatedMaterials[material].quantity;
                
                // 단가 저장
                savedPriceInputs[material] = { basic: basicPrice, daily: dailyPrice };
                
                // 총금액 = 수량 × (기본료 + (일단가 × 사용일수))
                const materialTotal = quantity * (basicPrice + (dailyPrice * usageDays));
                
                priceData[material] = {
                    basicPrice,
                    dailyPrice,
                    totalPrice: materialTotal
                };
                
                totalPrice += materialTotal;
            });
            
            // 금액 정보 업데이트
            updatePriceDisplay(totalPrice);

            // Google Analytics 데이터 전송
    const structureType = materialRatios[currentStructureType].name;
    sendPriceAnalytics(structureType, calculatedMaterials, totalPrice, usageDays);
        }
        
        // 금액 표시 업데이트
        function updatePriceDisplay(totalPrice) {
            // 금액 관련 열 표시
            document.querySelectorAll('.price-column').forEach(col => {
                col.style.display = 'table-cell';
            });
            
            document.querySelectorAll('.price-summary').forEach(elem => {
                elem.style.display = 'block';
            });
            
            // 총 금액 표시
            const volume = parseFloat(document.getElementById('volume').value);
            document.getElementById('totalPrice').textContent = totalPrice.toLocaleString() + '원';
            document.getElementById('pricePerM3').textContent = Math.round(totalPrice / volume).toLocaleString() + '원';
            
            // 테이블 다시 그리기
            displayResults(calculatedMaterials, volume, 
                parseFloat(document.getElementById('workHeight').textContent) * 1000,
                parseFloat(document.getElementById('totalWeight').textContent.replace('톤', '')) * 1000,
                materialRatios[currentStructureType].name,
                true);
        }
        
        // 결과 표시
        function displayResults(materials, volume, workHeight, totalWeight, structureName, showPrice = false) {
            // 결과 섹션 표시
            document.getElementById('resultSection').style.display = 'block';
            
            // 결과 정보
            document.getElementById('resultInfo').textContent = 
                `${structureName} | 공루베: ${volume}㎥`;
            
            // 주요 수량 표시
            let verticalTotal = 0;
            let horizontalTotal = 0;
            
            // 수직재 합계
            ['P17', 'P12', 'P08', 'P04', 'P02'].forEach(key => {
                if (materials[key]) {
                    verticalTotal += materials[key].quantity;
                }
            });
            
            // 수평재 합계
            ['H18', 'H15', 'H12', 'H09', 'H06', 'H03'].forEach(key => {
                if (materials[key]) {
                    horizontalTotal += materials[key].quantity;
                }
            });
            
            document.getElementById('verticalCount').textContent = verticalTotal.toLocaleString();
            document.getElementById('horizontalCount').textContent = horizontalTotal.toLocaleString();
            document.getElementById('uheadCount').textContent = materials['H'] ? materials['H'].quantity.toLocaleString() : '0';
            document.getElementById('baseCount').textContent = materials['J'] ? materials['J'].quantity.toLocaleString() : '0';
            
            // 상세 테이블 생성
            const tbody = document.getElementById('detailTableBody');
            tbody.innerHTML = '';
            
            // 자재 카테고리별로 정렬
            const categories = [
                { title: '수직재', items: ['P17', 'P12', 'P08', 'P04', 'P02'] },
                { title: '수평재', items: ['H18', 'H15', 'H12', 'H09', 'H06', 'H03'] },
                { title: '부속자재', items: ['H', 'J', 'S', 'T'] },
                { title: '멍에재', items: ['M3', 'M2.5', 'M2', 'M1.5', 'M1'] }
            ];
            
            let totalPrice = 0;
            
            categories.forEach(category => {
                let categoryHasItems = false;
                
                // 먼저 해당 카테고리에 항목이 있는지 확인
                category.items.forEach(item => {
                    if (materials[item] && materials[item].quantity > 0) {
                        categoryHasItems = true;
                    }
                });
                
                // 항목이 있을 때만 카테고리 헤더 추가
                if (categoryHasItems) {
                    const headerRow = tbody.insertRow();
                    const colspan = showPrice ? 8 : 5;
                    headerRow.innerHTML = `<td colspan="${colspan}" style="background: #e8f0ff; font-weight: bold; color: #1e3c72; font-size: 15px;">${category.title}</td>`;
                    
                    // 해당 카테고리의 자재들
                    category.items.forEach(item => {
                        if (materials[item] && materials[item].quantity > 0) {
                            const row = tbody.insertRow();
                            let rowHTML = `
                                <td>${materialNames[item]}</td>
                                <td>${item}</td>
                                <td style="text-align: right;">${materials[item].quantity.toLocaleString()}</td>
                                <td style="text-align: right;">${materials[item].unitWeight.toFixed(1)}</td>
                                <td style="text-align: right;">${materials[item].weight.toFixed(0).toLocaleString()}</td>
                            `;
                            
                            if (showPrice && priceData[item]) {
                                const itemTotalPrice = priceData[item].totalPrice;
                                totalPrice += itemTotalPrice;
                                rowHTML += `
                                    <td style="text-align: right;">${priceData[item].basicPrice.toLocaleString()}</td>
                                    <td style="text-align: right;">${priceData[item].dailyPrice.toLocaleString()}</td>
                                    <td style="text-align: right; font-weight: bold;">${itemTotalPrice.toLocaleString()}</td>
                                `;
                            }
                            
                            row.innerHTML = rowHTML;
                        }
                    });
                }
            });
            
            // 합계 행
            const totalRow = tbody.insertRow();
            totalRow.style.fontWeight = 'bold';
            totalRow.style.background = '#2a5298';
            totalRow.style.color = 'white';
            
            if (showPrice) {
                totalRow.innerHTML = `
                    <td colspan="2">합계</td>
                    <td style="text-align: right;">-</td>
                    <td style="text-align: right;">-</td>
                    <td style="text-align: right;">${totalWeight.toFixed(0).toLocaleString()}</td>
                    <td colspan="2" style="text-align: center;">총 금액</td>
                    <td style="text-align: right;">${totalPrice.toLocaleString()}</td>
                `;
            } else {
                totalRow.innerHTML = `
                    <td colspan="2">합계</td>
                    <td style="text-align: right;">-</td>
                    <td style="text-align: right;">-</td>
                    <td style="text-align: right;">${totalWeight.toFixed(0).toLocaleString()}</td>
                `;
            }
            
            // 요약 정보
            document.getElementById('totalVolume').textContent = `${volume}㎥`;
            document.getElementById('workHeight').textContent = `${(workHeight / 1000).toFixed(2)}m`;
            document.getElementById('totalWeight').textContent = `${(totalWeight / 1000).toFixed(1)}톤`;
            document.getElementById('weightPerM3').textContent = `${(totalWeight / volume).toFixed(1)}kg`;
            
            // 페이지 스크롤
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // 견적서 생성
        function generateQuotation() {
            const companyName = prompt('업체명을 입력하세요:', '');
            if (!companyName) return;
            
            const projectName = prompt('공사명을 입력하세요:', '');
            if (!projectName) return;
            
            // 비고란 기본 내용
            const defaultNotes = `- 부가세 별도
- 자재는 일단가 청구조건이며, 시험에 필요한 자재비 및 경비 별도 조건
- 물량은 산출 기준 : ${materialRatios[currentStructureType].name}
- 물량은 변경될 수 있으며, 실제 설치 물량으로 정산 조건
- 운반비 왕복 조건이며, 11톤 미만 출고시 청구조건`;
            
            // 비고란 내용 입력받기
            const notes = prompt('비고란 내용을 입력하세요 (각 항목은 줄바꿈으로 구분):', defaultNotes);
            
            const quotationWindow = window.open('', '_blank', 'width=900,height=1200');
            const volume = parseFloat(document.getElementById('volume').value);
            const today = new Date();
            const todayStr = today.getFullYear() + '년 ' + (today.getMonth() + 1) + '월 ' + today.getDate() + '일';
            const usageDays = parseInt(document.getElementById('usageDays').value) || 30;
            
            let totalAmount = 0;
            
            // 각 자재별 금액 계산
            for (const [key, material] of Object.entries(calculatedMaterials)) {
                if (material.quantity === 0) continue;
                const price = savedPriceInputs[key] || defaultPrices[key] || { basic: 0, daily: 0 };
                totalAmount += (price.basic + (price.daily * usageDays)) * material.quantity;
            }
            
            let quotationHTML = `
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <title>견적서 - ${companyName}</title>
                    <style>
                        @media print {
                            body { margin: 0; }
                            .page-break { page-break-after: always; }
                        }
                        body { 
                            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif; 
                            margin: 0;
                            padding: 20px;
                            background: white;
                        }
                        .quotation-container { 
                            max-width: 900px; 
                            margin: 0 auto; 
                            background: white;
                            padding: 40px;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 50px;
                        }
                        .title { 
                            font-size: 40px; 
                            font-weight: bold; 
                            margin-bottom: 40px;
                            letter-spacing: 20px;
                        }
                        .to-company {
                            font-size: 20px;
                            font-weight: bold;
                            margin-bottom: 20px;
                        }
                        .summary {
                            background: #f5f5f5;
                            padding: 20px;
                            margin-bottom: 30px;
                            border: 1px solid #ddd;
                        }
                        .summary-grid {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 10px;
                        }
                        .summary-item {
                            display: flex;
                            justify-content: space-between;
                            padding: 5px 0;
                        }
                        .summary-label {
                            font-weight: bold;
                        }
                        .amount-box {
                            text-align: center;
                            margin: 30px 0;
                            padding: 20px;
                            border: 2px solid #333;
                        }
                        .amount-label {
                            font-size: 18px;
                            margin-bottom: 10px;
                        }
                        .amount-value {
                            font-size: 28px;
                            font-weight: bold;
                            color: #2a5298;
                        }
                        .main-table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-bottom: 30px; 
                        }
                        .main-table th { 
                            background: #e8e8e8; 
                            padding: 10px; 
                            text-align: center; 
                            font-weight: bold;
                            border: 1px solid #999;
                            font-size: 14px;
                        }
                        .main-table td { 
                            padding: 8px; 
                            border: 1px solid #ccc; 
                            text-align: center;
                            font-size: 13px;
                        }
                        .main-table .category {
                            background: #f5f5f5;
                            font-weight: bold;
                            text-align: left;
                            padding-left: 15px;
                        }
                        .notes {
                            margin-top: 30px;
                            padding: 20px;
                            background: #f9f9f9;
                            border: 1px solid #ddd;
                        }
                        .notes h4 {
                            margin-bottom: 10px;
                            color: #333;
                        }
                        .notes ul {
                            margin: 0;
                            padding-left: 20px;
                        }
                        .notes li {
                            margin: 5px 0;
                            font-size: 13px;
                            color: #555;
                        }
                        .footer {
                            margin-top: 50px;
                            text-align: right;
                        }
                        .text-right { text-align: right !important; }
                        .text-left { text-align: left !important; }
                        .text-center { text-align: center !important; }
                        .edit-notes {
                            background: #fffbf0;
                            border: 1px dashed #ccc;
                            padding: 10px;
                            margin-bottom: 20px;
                            font-size: 12px;
                            color: #666;
                            text-align: center;
                        }
                    </style>
                </head>
                <body>
                    <div class="quotation-container">
                        <div class="header">
                            <h1 class="title">견 적 서</h1>
                        </div>
                        
                        <div class="to-company">${companyName} 귀하</div>
                        
                        <p style="font-size: 16px; margin-bottom: 30px;">아래와 같이 견적 합니다.</p>
                        
                        <div class="amount-box">
                            <div class="amount-label">금 액</div>
                            <div class="amount-value">₩ ${totalAmount.toLocaleString()}</div>
                        </div>
                        
                        <div class="summary">
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <span class="summary-label">공 사 명 :</span>
                                    <span>${projectName}</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">납 기 :</span>
                                    <span>추후 협의</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">결제조건 :</span>
                                    <span>정기 결제</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">인도장소 :</span>
                                    <span>추후 협의</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">견적유효 :</span>
                                    <span>견적일로부터 10일</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">견 적 일 :</span>
                                    <span>${todayStr}</span>
                                </div>
                            </div>
                        </div>
                        
                        <table class="main-table">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">품 명<br>ITEM</th>
                                    <th style="width: 20%;">규 격<br>SIZE</th>
                                    <th style="width: 10%;">단위<br>UNIT</th>
                                    <th style="width: 10%;">수량<br>Q'TY</th>
                                    <th style="width: 8%;">사용일<br>DAY</th>
                                    <th style="width: 12%;">단가<br>PRICE</th>
                                    <th style="width: 15%;">금액<br>AMOUNT</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            // 카테고리별로 자재 그룹화
            const categories = [
                { title: '수직재', items: ['P17', 'P12', 'P08', 'P04', 'P02'] },
                { title: '수평재', items: ['H18', 'H15', 'H12', 'H09', 'H06', 'H03'] },
                { title: '부속자재', items: ['H', 'J', 'S', 'T'] },
                { title: '멍에재', items: ['M3', 'M2.5', 'M2', 'M1.5', 'M1'] }
            ];
            
            // 테이블에 자재 추가
            for (const category of categories) {
                let categoryHasItems = false;
                category.items.forEach(item => {
                    if (calculatedMaterials[item] && calculatedMaterials[item].quantity > 0) {
                        categoryHasItems = true;
                    }
                });
                
                if (!categoryHasItems) continue;
                
                // 카테고리 헤더
                quotationHTML += `
                    <tr>
                        <td colspan="7" class="category">${category.title}</td>
                    </tr>
                `;
                
                // 각 아이템
                category.items.forEach(item => {
                    if (calculatedMaterials[item] && calculatedMaterials[item].quantity > 0) {
                        const material = calculatedMaterials[item];
                        const price = savedPriceInputs[item] || defaultPrices[item] || { basic: 0, daily: 0 };
                        const unitPrice = price.basic + (price.daily * usageDays);
                        const itemTotal = unitPrice * material.quantity;
                        
                        quotationHTML += `
                            <tr>
                                <td class="text-left" style="padding-left: 20px;">${materialNames[item]}</td>
                                <td>${item}</td>
                                <td>EA</td>
                                <td>${material.quantity.toLocaleString()}</td>
                                <td>${usageDays}</td>
                                <td class="text-right">${unitPrice.toLocaleString()}</td>
                                <td class="text-right">${itemTotal.toLocaleString()}</td>
                            </tr>
                        `;
                    }
                });
            }
            
            quotationHTML += `
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="6" class="text-center" style="font-weight: bold; background: #f0f0f0;">합 계</td>
                                    <td class="text-right" style="font-weight: bold; background: #f0f0f0;">${totalAmount.toLocaleString()}</td>
                                </tr>
                            </tfoot>
                        </table>
                        
                        <div class="notes">
                            <h4>[ 비 고 ]</h4>
                            <ul>
            `;
            
            // 비고란 내용 처리
            if (notes) {
                const noteLines = notes.split('\n');
                noteLines.forEach(line => {
                    if (line.trim()) {
                        // - 로 시작하지 않으면 추가
                        const formattedLine = line.trim().startsWith('-') ? line.trim().substring(1).trim() : line.trim();
                        quotationHTML += `<li>${formattedLine}</li>\n`;
                    }
                });
            }
            
            quotationHTML += `
                            </ul>
                        </div>
                        
                        <div class="edit-notes no-print">
                            ※ 인쇄 후 비고란에 추가 내용을 수기로 작성하실 수 있습니다.
                        </div>
                        
                        <div class="footer">
                            <p style="font-size: 16px;">위와 같이 견적합니다.</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            quotationWindow.document.write(quotationHTML);
            quotationWindow.document.close();
        }
        
        // 단가 데이터 저장
        function savePriceData() {
            const priceDataToSave = {};
            const allMaterials = ['P17', 'P12', 'P08', 'P04', 'P02', 'H18', 'H15', 'H12', 'H09', 'H06', 'H03', 'H', 'J', 'S', 'T', 'M3', 'M2.5', 'M2', 'M1.5', 'M1'];
            
            allMaterials.forEach(material => {
                const basicInput = document.getElementById(`basic_${material}`);
                const dailyInput = document.getElementById(`daily_${material}`);
                
                if (basicInput && dailyInput) {
                    priceDataToSave[material] = {
                        basic: parseFloat(basicInput.value) || 0,
                        daily: parseFloat(dailyInput.value) || 0
                    };
                }
            });
            
            // localStorage에 저장
            localStorage.setItem('systemSupportPriceData', JSON.stringify(priceDataToSave));
            alert('단가 정보가 저장되었습니다.');
        }
        
        // 단가 데이터 불러오기
        function loadPriceData() {
            const savedData = localStorage.getItem('systemSupportPriceData');
            if (!savedData) {
                alert('저장된 단가 정보가 없습니다.');
                return;
            }
            
            const priceDataToLoad = JSON.parse(savedData);
            savedPriceInputs = priceDataToLoad;
            
            Object.keys(priceDataToLoad).forEach(material => {
                const basicInput = document.getElementById(`basic_${material}`);
                const dailyInput = document.getElementById(`daily_${material}`);
                
                if (basicInput && dailyInput) {
                    basicInput.value = priceDataToLoad[material].basic || '';
                    dailyInput.value = priceDataToLoad[material].daily || '';
                }
            });
            
            alert('단가 정보를 불러왔습니다.');
        }
        
        // 현재 계산 결과 저장
        function saveCurrentCalculation() {
            const currentData = {
                id: Date.now(),
                date: new Date().toLocaleString(),
                structure: materialRatios[currentStructureType].name,
                volume: parseFloat(document.getElementById('volume').value),
                height: parseFloat(document.getElementById('height').value),
                slabThk: parseFloat(document.getElementById('slabThk').value),
                beamThk: parseFloat(document.getElementById('beamThk').value),
                materials: calculatedMaterials,
                priceData: priceData,
                usageDays: parseInt(document.getElementById('usageDays').value) || 30
            };
            
            savedCalculations.push(currentData);
            updateSavedDataList();
            
            // 데이터 취합 섹션 표시
            document.getElementById('combineSection').style.display = 'block';
        }
        
        // 저장된 데이터 목록 업데이트
        function updateSavedDataList() {
            const listContainer = document.getElementById('savedDataList');
            listContainer.innerHTML = '';
            
            savedCalculations.forEach((data, index) => {
                const item = document.createElement('div');
                item.className = 'saved-data-item';
                item.onclick = () => toggleDataSelection(index);
                
                let totalQuantity = 0;
                Object.values(data.materials).forEach(mat => {
                    totalQuantity += mat.quantity;
                });
                
                item.innerHTML = `
                    <h4>${data.structure}</h4>
                    <p>공루베: ${data.volume}㎥ | 층고: ${data.height}mm</p>
                    <p>총 자재수: ${totalQuantity.toLocaleString()}개</p>
                    <p>저장일시: ${data.date}</p>
                `;
                
                listContainer.appendChild(item);
            });
        }
        
        // 데이터 선택 토글
        function toggleDataSelection(index) {
            const items = document.querySelectorAll('.saved-data-item');
            const selectedIndex = selectedDataIndices.indexOf(index);
            
            if (selectedIndex > -1) {
                selectedDataIndices.splice(selectedIndex, 1);
                items[index].classList.remove('selected');
            } else {
                selectedDataIndices.push(index);
                items[index].classList.add('selected');
            }
        }
        
        // 데이터 취합
        function combineData() {
            if (selectedDataIndices.length < 2) {
                alert('취합할 데이터를 2개 이상 선택해주세요.');
                return;
            }
            
            // 취합된 데이터 생성
            const combinedMaterials = {};
            const combinedStructures = [];
            let totalVolume = 0;
            
            selectedDataIndices.forEach(index => {
                const data = savedCalculations[index];
                combinedStructures.push(data.structure);
                totalVolume += data.volume;
                
                // 자재 수량 합산
                Object.keys(data.materials).forEach(material => {
                    if (!combinedMaterials[material]) {
                        combinedMaterials[material] = {
                            quantity: 0,
                            weight: 0,
                            unitWeight: data.materials[material].unitWeight
                        };
                    }
                    combinedMaterials[material].quantity += data.materials[material].quantity;
                    combinedMaterials[material].weight += data.materials[material].weight;
                });
            });
            
            // 취합 결과 표시
            displayCombinedResults(combinedMaterials, combinedStructures, totalVolume);
        }
        
        // 취합 결과 표시
        function displayCombinedResults(materials, structures, totalVolume) {
            // 새로운 모달 창으로 표시
            let modalHTML = '<h3>📊 취합 결과</h3>';
            modalHTML += `<p style="margin-bottom: 20px;">취합 구조: ${structures.join(' + ')}</p>`;
            modalHTML += `<p style="margin-bottom: 20px;">총 공루베: ${totalVolume}㎥</p>`;
            
            modalHTML += '<table class="detail-table">';
            modalHTML += '<thead><tr><th>품명</th><th>규격</th><th>총수량</th><th>단위중량(kg)</th><th>총중량(kg)</th></tr></thead>';
            modalHTML += '<tbody>';
            
            const categories = [
                { title: '수직재', items: ['P17', 'P12', 'P08', 'P04', 'P02'] },
                { title: '수평재', items: ['H18', 'H15', 'H12', 'H09', 'H06', 'H03'] },
                { title: '부속자재', items: ['H', 'J', 'S', 'T'] },
                { title: '멍에재', items: ['M3', 'M2.5', 'M2', 'M1.5', 'M1'] }
            ];
            
            let totalWeight = 0;
            
            categories.forEach(category => {
                let categoryHasItems = false;
                category.items.forEach(item => {
                    if (materials[item] && materials[item].quantity > 0) {
                        categoryHasItems = true;
                    }
                });
                
                if (categoryHasItems) {
                    modalHTML += `<tr><td colspan="5" style="background: #e8f0ff; font-weight: bold; color: #1e3c72;">${category.title}</td></tr>`;
                    
                    category.items.forEach(item => {
                        if (materials[item] && materials[item].quantity > 0) {
                            totalWeight += materials[item].weight;
                            modalHTML += `
                                <tr>
                                    <td>${materialNames[item]}</td>
                                    <td>${item}</td>
                                    <td style="text-align: right;">${materials[item].quantity.toLocaleString()}</td>
                                    <td style="text-align: right;">${materials[item].unitWeight.toFixed(1)}</td>
                                    <td style="text-align: right;">${materials[item].weight.toFixed(0).toLocaleString()}</td>
                                </tr>
                            `;
                        }
                    });
                }
            });
            
            modalHTML += `<tr style="font-weight: bold; background: #2a5298; color: white;">
                <td colspan="2">합계</td>
                <td style="text-align: right;">-</td>
                <td style="text-align: right;">-</td>
                <td style="text-align: right;">${totalWeight.toFixed(0).toLocaleString()}</td>
            </tr>`;
            
            modalHTML += '</tbody></table>';
            
            modalHTML += '<div class="button-group" style="margin-top: 20px;">';
            modalHTML += '<button class="button button-success" onclick="exportCombinedToExcel()">엑셀 내보내기</button>';
            modalHTML += '</div>';
            
            // 모달 표시
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <button class="close-modal" onclick="this.parentElement.parentElement.remove()">×</button>
                    ${modalHTML}
                </div>
            `;
            document.body.appendChild(modal);
            
            // 전역 변수에 저장 (엑셀 내보내기용)
            window.combinedExportData = {
                materials,
                structures,
                totalVolume,
                totalWeight
            };
        }
        
        // 디버그 모드 토글
        function toggleDebug() {
            // 디버그 기능 제거됨
        }
        
        // 비율표 보기
        function showRatioTable() {
            // 비율표 기능 제거됨
        }
        
        // 엑셀 내보내기
        function exportToExcel() {
            const structureName = materialRatios[currentStructureType].name;
            const volume = document.getElementById('volume').value;
            const usageDays = document.getElementById('usageDays').value;
            const showPrice = Object.keys(priceData).length > 0;
            
            // CSV 헤더
            let csv = '\ufeff'; // BOM for UTF-8
            csv += '시스템 동바리 물량 산출서\n';
            csv += `구조 타입:,${structureName}\n`;
            csv += `설치 물량:,${volume}㎥\n`;
            
            if (showPrice) {
                csv += `사용 일수:,${usageDays}일\n`;
            }
            
            csv += `작성일:,${new Date().toLocaleDateString()}\n\n`;
            
            if (showPrice) {
                csv += '품명,규격,수량,단위중량(kg),총중량(kg),기본료(원),일단가(원),총금액(원)\n';
            } else {
                csv += '품명,규격,수량,단위중량(kg),총중량(kg)\n';
            }
            
            // 테이블 데이터
            const rows = document.querySelectorAll('#detailTableBody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const rowData = Array.from(cells).map(cell => cell.textContent);
                csv += rowData.join(',') + '\n';
            });
            
            // 다운로드
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `시스템동바리_물량산출_${structureName}_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
        }
        
        // 초기화
        function resetCalculator() {
            document.getElementById('volume').value = '100';
            document.getElementById('height').value = '5000';
            document.getElementById('slabThk').value = '200';
            document.getElementById('beamThk').value = '0';
            document.getElementById('safetyRate').value = '0';
            document.getElementById('safetyRateDisplay').textContent = '0';
            document.getElementById('usageDays').value = '30';
            
            // 구조 타입 초기화
            currentStructureType = 'wall';
            document.querySelectorAll('.structure-type-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector('.structure-type-card').classList.add('active');
            
            // 결과 섹션 숨기기
            document.getElementById('resultSection').style.display = 'none';
            
            // 단가 데이터 초기화
            priceData = {};
            calculatedMaterials = {};
            savedCalculations = [];
            selectedDataIndices = [];
            
            // 단가 섹션 숨기기
            document.getElementById('priceInputContainer').style.display = 'none';
            document.querySelector('.toggle-price-btn').textContent = '단가 입력';
            
            // 데이터 취합 섹션 숨기기
            document.getElementById('combineSection').style.display = 'none';
            
            // 금액 열 숨기기
            document.querySelectorAll('.price-column').forEach(col => {
                col.style.display = 'none';
            });
            
            document.querySelectorAll('.price-summary').forEach(elem => {
                elem.style.display = 'none';
            });
            
            // 스크롤 맨 위로
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // 우클릭 방지
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            alert('© 2025 가설파트너\n본 프로그램의 저작권은 보호됩니다.');
            return false;
        });
        
        // 개발자 도구 방지
        document.addEventListener('keydown', function(e) {
            // F12
            if (e.key === 'F12') {
                e.preventDefault();
                alert('개발자 도구 사용이 제한되어 있습니다.');
                return false;
            }
            // Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+Shift+C
            if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) {
                e.preventDefault();
                alert('개발자 도구 사용이 제한되어 있습니다.');
                return false;
            }
            // Ctrl+U (소스보기)
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                alert('소스 코드 보기가 제한되어 있습니다.');
                return false;
            }
        });
        
        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 엔터키로 계산 실행
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.target.tagName === 'INPUT') {
                    calculateQuantity();
                }
            });
            
            // 타이틀 보호
            const originalTitle = '시스템 동바리 물량 계산기 v1.0 - 가설파트너';
            setInterval(() => {
                if (document.title !== originalTitle) {
                    document.title = originalTitle;
                }
            }, 100);
            
            // 파일명 변경 경고
            if (window.location.pathname) {
                const fileName = window.location.pathname.split('/').pop();
                const expectedFileName = '시스템 동바리 계산기.html';
                
                if (fileName && decodeURIComponent(fileName) !== expectedFileName && fileName !== '') {
                    console.warn(`⚠️ 경고: 파일명이 변경되었습니다!\n원본 파일명: ${expectedFileName}\n현재 파일명: ${decodeURIComponent(fileName)}\n\n© 2025 가설파트너`);
                }
            }
        });
    </script>
</body>
</html>